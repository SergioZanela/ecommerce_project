{% extends "base.html" %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
  <h1>{{ product.name }}</h1>

  <p class="badge">Store: {{ product.store.name }}</p>

  <div style="margin-top:16px;">
    <div class="item">
      <div style="margin-bottom:10px;">
        <strong>Price:</strong>
        <span class="badge">${{ product.price }}</span>
      </div>

      {% if product.description %}
        <p>{{ product.description }}</p>
      {% endif %}

      {% if not product.is_active %}
        <p class="badge">This product is currently inactive.</p>
      {% endif %}
    </div>
  </div>

  <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
    <a class="btn" href="{% url 'public_store_detail' product.store.id %}">‚Üê Back to Store</a>

    {% if user.is_authenticated %}
      <a class="btn" href="{% url 'cart_add' product.id %}">Add to Cart</a>
    {% else %}
      <a class="btn" href="{% url 'login' %}">Login to buy</a>
    {% endif %}
  </div>

  <hr style="margin:18px 0; border:0; border-top:1px solid var(--border);" />

  <h2>Reviews</h2>

  {% if reviews %}
    <ul class="list" style="margin-top:12px;">
      {% for r in reviews %}
        <li class="item">
          <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
            <div>
              <strong>{{ r.author.username }}</strong>
              <span class="badge">Rating: {{ r.rating }}/5</span>
              {% if r.verified %}
                <span class="badge">Verified purchase</span>
              {% else %}
                <span class="badge">Unverified</span>
              {% endif %}
              <div style="margin-top:8px; color: var(--muted);">
                {{ r.comment }}
              </div>
            </div>
            <div class="badge">
              {{ r.created_at|date:"Y-m-d H:i" }}
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No reviews yet.</p>
  {% endif %}

  <div style="margin-top:18px;">
    <h2>Leave a review</h2>

    {% if user.is_authenticated %}
      <form method="post">
        {% csrf_token %}

        <div class="form-row">
          <label>Rating (1 to 5)</label>
          {{ form.rating }}
        </div>

        <div class="form-row">
          <label>Comment</label>
          {{ form.comment }}
        </div>

        <button class="btn" type="submit">Post review</button>
      </form>
    {% else %}
      <p>
        <a class="btn" href="{% url 'login' %}">Login</a>
        <span style="color: var(--muted);">to leave a review.</span>
      </p>
    {% endif %}
  </div>
{% endblock %}

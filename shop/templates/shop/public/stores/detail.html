{% extends "base.html" %}

{% block title %}{{ store.name }}{% endblock %}

{% block content %}
  <h1>{{ store.name }}</h1>
  <p>{{ store.description }}</p>

  <!-- ‚≠ê Store Rating -->
  <div style="margin-top:10px;">
    {% if average_rating %}
      <p class="badge">
        ‚≠ê Average rating: {{ average_rating|floatformat:1 }} / 5
      </p>
    {% else %}
      <p class="badge">‚≠ê No ratings yet</p>
    {% endif %}
  </div>

  <div style="margin:12px 0; display:flex; gap:10px; flex-wrap:wrap;">
    <a class="btn" href="{% url 'public_store_list' %}">‚Üê Back to stores</a>
    <a class="btn" href="{% url 'cart_detail' %}">View cart</a>
  </div>

  <!-- üîç Search -->
  <form method="get" style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
    <input
      type="text"
      name="q"
      placeholder="Search products..."
      value="{{ request.GET.q }}"
      style="flex:1; min-width:220px;"
    />
    <button class="btn" type="submit">Search</button>

    {% if request.GET.q %}
      <a class="btn" href="{% url 'public_store_detail' store.id %}">Clear</a>
    {% endif %}
  </form>

  {% if request.GET.q %}
    <p style="margin-top:10px;" class="badge">
      Showing results for: ‚Äú{{ request.GET.q }}‚Äù
    </p>
  {% endif %}

  <h2 style="margin-top:18px;">Products</h2>

  {% if products %}
    <ul class="list">
      {% for p in products %}
        <li class="item">
          <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
            <div>
              <strong>{{ p.name }}</strong>
              <div class="badge" style="margin-top:8px;">${{ p.price }}</div>
              <div style="margin-top:8px; color: var(--muted);">{{ p.description }}</div>
            </div>

            <div style="display:flex; gap:8px;">
              <a class="btn" href="{% url 'public_product_detail' p.id %}">Details</a>
              {% if user.is_authenticated %}
                <a class="btn" href="{% url 'cart_add' p.id %}">Add to cart</a>
              {% else %}
                <a class="btn" href="{% url 'login' %}">Login to buy</a>
              {% endif %}
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>

    <!-- üìÑ Pagination -->
    {% if page_obj.paginator.num_pages > 1 %}
      <div style="margin-top:18px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">

        {% if page_obj.has_previous %}
          <a class="btn"
             href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
            ‚Üê Previous
          </a>
        {% endif %}

        <span class="badge">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
          <a class="btn"
             href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
            Next ‚Üí
          </a>
        {% endif %}

      </div>
    {% endif %}

  {% else %}
    {% if request.GET.q %}
      <p>No results found for ‚Äú{{ request.GET.q }}‚Äù.</p>
    {% else %}
      <p>No products yet.</p>
    {% endif %}
  {% endif %}
{% endblock %}
